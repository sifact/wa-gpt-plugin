(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(o){if(o.ep)return;o.ep=!0;const t=e(o);fetch(o.href,t)}})();document.addEventListener("DOMContentLoaded",()=>{console.log("DOM LOADED - Popup Initialized");const s=document.getElementById("enableAutomation");console.log("enableAutomationCheckbox found:",s);const r=document.getElementById("enablePartialAutomation");console.log("enablePartialAutomationCheckbox found:",r);const e=document.getElementById("statusMessage"),i=document.getElementById("activityLog");function o(t,a="info"){i.firstChild&&i.firstChild.textContent==="No activity yet."&&(i.innerHTML="");const n=document.createElement("p");for(n.textContent=`[${new Date().toLocaleTimeString()}] ${t}`,n.className=a,i.prepend(n);i.children.length>20;)i.removeChild(i.lastChild)}o("WhatsApp ChatGPT Bridge popup opened. Settings are being loaded."),s||(console.error("CRITICAL ERROR: enableAutomationCheckbox element not found!"),o("Error: Main automation toggle not found","error")),r||(console.error("CRITICAL ERROR: enablePartialAutomationCheckbox element not found!"),o("Error: Partial automation toggle not found","error")),chrome.runtime.sendMessage({action:"getSettings"},t=>{if(chrome.runtime.lastError){console.error("Popup: Error getting settings:",chrome.runtime.lastError.message),e.textContent="Error loading settings: "+chrome.runtime.lastError.message,e.className="error";return}t&&t.error?(console.error("Popup: Error from background getting settings:",t.error),e.textContent="Error loading settings: "+t.error,e.className="error"):t?(console.log("Popup: Settings loaded",t),console.log("Popup: isEnabled =",t.isEnabled,"isPartialAutomation =",t.isPartialAutomation),s&&(s.checked=t.isEnabled===!0,console.log("Set enableAutomationCheckbox.checked to",s.checked)),r&&(r.checked=t.isPartialAutomation===!0,console.log("Set enablePartialAutomationCheckbox.checked to",r.checked))):(console.warn("Popup: No response or empty settings received."),e.textContent="Could not load settings.",e.className="error")}),s&&s.addEventListener("change",()=>{const t=s.checked;console.log("Popup: Toggle changed to:",t),e.textContent=t?"Enabling automation...":"Disabling automation...",e.className="";const a={isEnabled:t,isPartialAutomation:r?r.checked:!1};console.log("Popup: Saving new settings:",a),chrome.runtime.sendMessage({action:"saveSettings",settings:a},n=>{chrome.runtime.lastError?(console.error("Popup: Error sending saveSettings message:",chrome.runtime.lastError.message),e.textContent="Error saving: "+chrome.runtime.lastError.message,e.className="error"):n&&n.error?(console.error("Popup: Error from background saving settings:",n.error),e.textContent="Error saving: "+n.error,e.className="error"):n&&n.status==="Settings saved"?(e.textContent="Settings saved successfully!",e.className="success",console.log("Popup: Settings saved successfully.")):(e.textContent="Failed to save settings. Unknown response.",e.className="error",console.warn("Popup: Unknown response from saveSettings:",n)),setTimeout(()=>{e.className!=="error"&&(e.textContent="",e.className="")},3e3)})}),r?r.addEventListener("change",()=>{const t=r.checked;console.log("Popup: Partial automation toggle changed to:",t),e.textContent=t?"Enabling partial automation...":"Disabling partial automation...",e.className="";const a={isEnabled:s?s.checked:!0,isPartialAutomation:t};console.log("Popup: Saving new partial automation settings:",a),chrome.runtime.sendMessage({action:"saveSettings",settings:a},n=>{chrome.runtime.lastError?(console.error("Popup: Error sending saveSettings message:",chrome.runtime.lastError.message),e.textContent="Error saving: "+chrome.runtime.lastError.message,e.className="error"):n&&n.error?(console.error("Popup: Error from background saving settings:",n.error),e.textContent="Error saving: "+n.error,e.className="error"):n&&n.status==="Settings saved"?(e.textContent="WhatsApp partial automation settings saved!",e.className="success",console.log("Popup: Partial automation settings saved successfully.")):(e.textContent="Failed to save settings. Unknown response.",e.className="error",console.warn("Popup: Unknown response from saveSettings:",n)),setTimeout(()=>{e.className!=="error"&&(e.textContent="",e.className="")},3e3)})}):console.error("Cannot add event listener - enablePartialAutomationCheckbox is null")});
